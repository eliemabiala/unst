{% extends 'base.html.twig' %}

{% block title %}Conversation
{% endblock %}

{% block body %}
	<div
		class="container mx-auto mt-40 my-8 p-4">

		<!-- Titre centré -->
		<h2 class="text-xl font-bold mb-4 text-center">
			{% for participant in conversation.participants %}
				{% if participant != app.user %}
					{{ participant.profile ? participant.profile.firstname : 'Nom indisponible' }}
				{% endif %}
			{% endfor %}
		</h2>

		<!-- Liste des messages avec largeur uniforme et centrage -->
{% set today = "now"|date("Y-m-d") %}

<ul class="space-y-3 mb-6">
	{% for message in conversation.messages %}
		{% if message.author == app.user %}
			<!-- Message de l'utilisateur actuel -->
			<li class="bg-blue-900 text-white p-4 rounded-lg w-3/4 mx-auto relative">
				<p class="text-white">{{ message.content }}</p>
				<!-- Afficher l'heure si le message est d'aujourd'hui, sinon afficher date + heure -->
				<small class="text-xs text-gray-300 absolute bottom-2 right-2">
					{% if message.createdAt|date("Y-m-d") == today %}
						{{ message.createdAt|date('H:i') }}
					{% else %}
						{{ message.createdAt|date('d-m-Y H:i') }}
					{% endif %}
				</small>
			</li>
		{% else %}
			<!-- Message d'un autre utilisateur -->
			<li class="bg-indigo-700 text-white p-4 rounded-lg w-3/4 mx-auto relative">
				<p class="text-white">{{ message.content }}</p>
				<!-- Afficher l'heure si le message est d'aujourd'hui, sinon afficher date + heure -->
				<small class="text-xs text-gray-300 absolute bottom-2 right-2">
					{% if message.createdAt|date("Y-m-d") == today %}
						{{ message.createdAt|date('H:i') }}
					{% else %}
						{{ message.createdAt|date('d-m-Y H:i') }}
					{% endif %}
				</small>
			</li>
		{% endif %}
	{% endfor %}
</ul>



		<!-- Formulaire d'envoi de message -->
		{{ form_start(form) }}
		<div class="mb-4">
			{{ form_widget(form.content, {'attr': {'class': 'w-full p-2 rounded-lg bg-gray-200', 'placeholder': 'Rédigez un message............'}}) }}
		</div>
		<div
			class="flex justify-between items-center mb-4">
			<!-- Bouton pour revenir en arrière (aligné à gauche) -->
			<button onclick="history.back()" class="bg-[#14213D] text-white py-2 px-4 rounded hover:text-[#b49047] transition duration-300">
				← Retour
			</button>

			<!-- Bouton pour envoyer le message (aligné à droite) -->
			<button type="submit" class="bg-[#14213D] text-white py-2 px-4 rounded hover:text-[#b49047] transition duration-300">
				Envoyer
			</button>
		</div>
		{{ form_end(form) }}
	</div>
{% endblock %}

